---
title: Apollo planning
date: 2023-01-18 14:12:54
tags:
---

此篇博客介绍 planning


planning 通过基于frenet坐标系的指引线来降低计算的维度，使其变成了一个基于frenet坐标系下的3维约束的最优化问题
通常有两种方法：
1. 直接进行三维优化
2. 路径和速度解耦的方法

直接进行三维优化的方法是试图在SLT内使用轨迹采样或网格搜索来寻找最佳轨迹。这些方法受到其搜索复杂度的限制，随着空间和时间搜索分辨率的提高，搜索复杂度也在增加，为了满足实时性的需求，
通常需要增加网格大小或者采样分辨率，因此生成的轨迹是次优的

路径-速度解耦方法则分别对路径和速度进行优化。 路径优化通常考虑静态障碍物，然后根据生成的路径生成速度曲线， 随着动态障碍物的出现，路径-速度解耦法有可能不是最佳选择，但是由于路径和速度是解耦的，这种方法在路径和速度的优化方面实现了更大的灵活性。


EM规划器迭代的优化路径和速度， 在路径优化器中，上一周期的速度曲线被用来估计与此周期低速动态障碍物的相互作用。然后生成的路径被发送到速度优化器，以评估一个最佳速度曲线。对于高速动态障碍物，EM规划器出于安全考虑，更倾向于采取变道而不是nudge的方式。因此EM规划器的迭代策略能够去处理路径-速度解耦的框架下的动态障碍物


EM planner中，在提供平滑轨迹之前会先做决策，决策的作用是使车辆在路上的意图明确，减少寻找最佳轨迹的搜索空间。决策通常可以分为基于规则和基于模型的决策。

首先，用一个粗略可行的轨迹来描述自车的移动意图，用这个轨迹也表示了自车与障碍物之间的相互作用。其次，规划器还将根据轨迹为平滑样条曲线参数生成一个凸的可行空间。
一个基于凸优化的平滑样条求解器可以用来根据决策生成平滑的路径和速度曲线。这保证了一个可行的、平稳的解决方案

QP样条路径通过求解器求解优化线性约束下的目标函数得到

其中QP的目标函数是 平滑损失函数与指导线损失函数，指导线就是DP阶段提供的路径
QP路径中的约束包括边界约束和动态可行性